<!doctype html>
<html lang="es" class="scroll-smooth">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Archivos del Sur - Migraciones</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        />
        <meta
            name="description"
            content="Información migratoria entre los años 1907–1931 recolatada por Archivos del Sur"
        />
        <style>
            /* Evita que los gráficos se desborden y facilita el responsive */
            .chart-wrap {
                position: relative;
            }
        </style>
    </head>
    <body class="bg-zinc-50 text-zinc-900 antialiased">
        <!-- Hero con imagen + degradado -->
        <section class="relative h-48 sm:h-64 md:h-80 lg:h-[28rem]">
            <div class="absolute inset-0">
                <div
                    class="h-full w-full bg-center bg-cover"
                    style="background-image: url(&quot;header.jpg&quot;)"
                ></div>
                <div
                    class="absolute inset-0 bg-gradient-to-b from-black/50 via-black/30 to-transparent"
                ></div>
                <div
                    class="absolute inset-0 bg-amber-900/20 mix-blend-multiply"
                ></div>
            </div>
            <div
                class="relative max-w-7xl mx-auto h-full px-4 sm:px-6 lg:px-8 flex items-end pb-6"
            >
                <div class="max-w-2xl">
                    <h1
                        class="text-3xl md:text-5xl font-extrabold text-white drop-shadow-md"
                    >
                        Datos migratorios
                        <span class="opacity-90 font-semibold">1907–1931</span>
                    </h1>
                    <p class="mt-2 text-white/90 drop-shadow">
                        Archivos del Sur
                    </p>
                </div>
            </div>
        </section>

        <!-- Navbar -->
        <nav class="bg-white shadow-sm sticky top-0 z-30">
            <div
                class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex flex-wrap gap-3 items-center justify-center text-sm text-zinc-600"
            >
                <a href="#resumen" class="hover:text-zinc-900">Resumen</a>
                <a href="#mapas" class="hover:text-zinc-900">Mapas</a>
                <span class="hidden sm:inline">·</span>
                <a href="#nacimientos" class="hover:text-zinc-900"
                    >Nacimientos</a
                >
                <span class="hidden sm:inline">·</span>
                <a href="#migraciones" class="hover:text-zinc-900"
                    >Migraciones</a
                >
                <span class="hidden sm:inline">·</span>
                <a href="#estado-civil" class="hover:text-zinc-900"
                    >Estado civil</a
                >
                <span class="hidden sm:inline">·</span>
                <a href="#profesiones" class="hover:text-zinc-900"
                    >Profesiones</a
                >
                <span class="hidden sm:inline">·</span>
                <a href="#asentamientos" class="hover:text-zinc-900"
                    >Asentamientos</a
                >
                <span class="hidden sm:inline">·</span>
                <a href="#proveniencia" class="hover:text-zinc-900"
                    >Lugar de Origen</a
                >
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
            <!-- Resumen -->
            <section id="resumen" class="space-y-4">
                <h2 class="text-xl md:text-2xl font-semibold">Resumen</h2>
                <div
                    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"
                >
                    <article class="bg-white rounded-2xl shadow p-5">
                        <h3 class="text-sm text-zinc-500">
                            Cantidad de registros migratorios
                        </h3>
                        <p class="text-3xl font-extrabold mt-1">
                            2860
                            <span class="text-base font-medium text-zinc-500"
                                >registros</span
                            >
                        </p>
                    </article>
                    <article class="bg-white rounded-2xl shadow p-5">
                        <h3 class="text-sm text-zinc-500">
                            Lugar con mayor cantidad de asentamientos
                        </h3>
                        <p class="mt-2 text-zinc-800">
                            <span class="font-semibold">Bariloche</span> → 539
                            personas
                        </p>
                    </article>
                    <article class="bg-white rounded-2xl shadow p-5">
                        <h3 class="text-sm text-zinc-500">
                            La mayoría provenia de
                        </h3>
                        <p class="mt-2 text-zinc-800">
                            <span class="font-semibold">Temuco</span> → 205
                            personas
                        </p>
                    </article>
                    <article class="bg-white rounded-2xl shadow p-5">
                        <h3 class="text-sm text-zinc-500">
                            Profesión más comun
                        </h3>
                        <p class="mt-2 text-zinc-800">
                            <span class="font-semibold">Jornalero</span> → 1015
                            personas
                        </p>
                    </article>
                    <article class="bg-white rounded-2xl shadow p-5">
                        <h3 class="text-sm text-zinc-500">Edad promedio</h3>
                        <p class="text-3xl font-extrabold mt-1">
                            29
                            <span class="text-base font-medium text-zinc-500"
                                >años</span
                            >
                        </p>
                    </article>
                    <article class="bg-white rounded-2xl shadow p-5">
                        <h3 class="text-sm text-zinc-500">Más longevo</h3>
                        <p class="text-3xl font-extrabold mt-1">
                            78
                            <span class="text-base font-medium text-zinc-500"
                                >años</span
                            >
                        </p>
                    </article>
                    <article class="bg-white rounded-2xl shadow p-5">
                        <h3 class="text-sm text-zinc-500">
                            Año con más nacimientos
                        </h3>
                        <p class="mt-2 text-zinc-800">
                            <span class="font-semibold">1905</span> → 682
                            nacimientos
                        </p>
                    </article>
                    <article class="bg-white rounded-2xl shadow p-5">
                        <h3 class="text-sm text-zinc-500">
                            Año con mayor migración
                        </h3>
                        <p class="mt-2 text-zinc-800">
                            <span class="font-semibold">1913</span> → 331
                            personas
                        </p>
                    </article>
                </div>
            </section>

            <!-- Mapa de flujos -->
            <section id="mapas" class="space-y-4">
                <div class="flex items-end justify-between">
                    <h3 class="text-xl md:text-2xl font-semibold">
                        Mapa de orígenes y asentamientos
                    </h3>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    <div class="bg-white rounded-2xl shadow p-4">
                        <h4 class="text-sm text-zinc-500 mb-2">
                            Lugares de origen (Chile)
                        </h4>
                        <!-- Altura explícita para Leaflet -->
                        <div
                            id="mapOrigen"
                            class="rounded-xl overflow-hidden h-96 md:h-[32rem]"
                        ></div>
                    </div>
                    <div class="bg-white rounded-2xl shadow p-4">
                        <h4 class="text-sm text-zinc-500 mb-2">
                            Asentamientos (Argentina)
                        </h4>
                        <div
                            id="mapDestino"
                            class="rounded-xl overflow-hidden h-96 md:h-[32rem]"
                        ></div>
                    </div>
                </div>
                <p class="text-xs text-zinc-500">
                    Las ubicaciones son aproximadas para visualización
                    histórica.
                </p>
            </section>

            <!-- Nacimientos -->
            <section id="nacimientos" class="space-y-4">
                <div class="flex items-end justify-between">
                    <h2 class="text-xl md:text-2xl font-semibold">
                        Años con más nacimientos
                    </h2>
                </div>
                <div class="bg-white rounded-2xl shadow p-4">
                    <div class="chart-wrap h-64 sm:h-72 md:h-80 lg:h-96">
                        <canvas id="chartNacimientos"></canvas>
                    </div>
                </div>
            </section>

            <!-- Migraciones -->
            <section id="migraciones" class="space-y-4">
                <div class="flex items-end justify-between">
                    <h2 class="text-xl md:text-2xl font-semibold">
                        Años con más registros de migraciones
                    </h2>
                </div>
                <div class="bg-white rounded-2xl shadow p-4">
                    <div class="chart-wrap h-72 md:h-80 lg:h-[28rem]">
                        <canvas id="chartMigraciones"></canvas>
                    </div>
                </div>
            </section>

            <!-- Estado civil -->
            <section id="estado-civil" class="space-y-4">
                <div class="flex items-end justify-between">
                    <h2 class="text-xl md:text-2xl font-semibold">
                        Estado civil
                    </h2>
                </div>
                <div class="bg-white rounded-2xl shadow p-4">
                    <div class="chart-wrap h-64 md:h-72 lg:h-80">
                        <canvas id="chartEstadoCivil"></canvas>
                    </div>
                </div>
            </section>

            <!-- Profesiones -->
            <section id="profesiones" class="space-y-4">
                <div class="flex items-end justify-between">
                    <h2 class="text-xl md:text-2xl font-semibold">
                        Profesiones
                    </h2>
                </div>
                <div class="bg-white rounded-2xl shadow p-4">
                    <div class="chart-wrap h-[32rem] md:h-[36rem]">
                        <canvas id="chartProfesiones"></canvas>
                    </div>
                </div>
            </section>

            <!-- Asentamientos -->
            <section id="asentamientos" class="space-y-4">
                <div class="flex items-end justify-between">
                    <h2 class="text-xl md:text-2xl font-semibold">
                        Lugares donde más se asentaron
                    </h2>
                </div>
                <div class="bg-white rounded-2xl shadow p-4">
                    <div class="chart-wrap h-[34rem] md:h-[38rem]">
                        <canvas id="chartAsentamientos"></canvas>
                    </div>
                </div>
            </section>

            <!-- Proveniencia -->
            <section id="proveniencia" class="space-y-4">
                <div class="flex items-end justify-between">
                    <h2 class="text-xl md:text-2xl font-semibold">
                        ¿De dónde provenían?
                    </h2>
                </div>
                <div class="bg-white rounded-2xl shadow p-4">
                    <div class="chart-wrap h-[32rem] md:h-[36rem]">
                        <canvas id="chartProveniencia"></canvas>
                    </div>
                </div>
            </section>
        </main>

        <footer class="border-t bg-white">
            <div
                class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-sm text-zinc-500"
            >
                Archivos del Sur + Cooperativa de Trabajo Lawal + Consulado de
                Chile
            </div>
        </footer>

        <!-- Leaflet JS + Heat plugin (antes de tu script principal) -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

        <script>
            // ----- Datos -----
            const datosNacimientos = {
                labels: ["1905", "1900", "1903"],
                values: [682, 49, 10],
            };

            const datosMigraciones = {
                labels: ["1913", "1919", "1920", "1924", "1925"],
                values: [331, 196, 172, 167, 148],
            };

            const datosEstadoCivil = {
                labels: ["Soltero", "Casado", "Viudo"],
                values: [1247, 27, 26],
            };

            const datosProfesiones = {
                labels: [
                    "Jornalero",
                    "Agricultor",
                    "Criancero/Ganadero",
                    "Empleado",
                    "Campista",
                ],
                values: [1015, 764, 415, 38, 32],
            };

            const datosAsentamientos = {
                labels: [
                    "Bariloche",
                    "Pichi Leufu",
                    "El Bolsón",
                    "Ñorquinco",
                    "Comallo",
                    "Las Bayas",
                    "Pilcaniyeu",
                    "Cholila",
                    "Epuyén",
                    "16 de Octubre",
                ],
                values: [539, 137, 125, 108, 91, 90, 72, 66, 43, 35],
            };

            const datosProveniencia = {
                labels: [
                    "Temuco",
                    "Pitrufquén",
                    "Osorno",
                    "San Pablo",
                    "Puerto Montt",
                    "Victoria",
                    "Lonquimay",
                    "Boroa",
                    "Chonchi",
                    "Santa Bárbara",
                ],
                values: [205, 99, 95, 82, 68, 64, 54, 56, 47, 46],
            };

            // ----- Mapas (Leaflet) -----
            const origen = [
                { name: "Temuco", lat: -38.735, lng: -72.59, w: 205 },
                { name: "Pitrufquén", lat: -39.233, lng: -72.65, w: 99 },
                { name: "Osorno", lat: -40.574, lng: -73.133, w: 95 },
                { name: "San Pablo", lat: -40.409, lng: -73.01, w: 82 },
                { name: "Puerto Montt", lat: -41.471, lng: -72.942, w: 68 },
                { name: "Victoria", lat: -38.232, lng: -72.332, w: 64 },
                { name: "Lonquimay", lat: -38.433, lng: -71.233, w: 54 },
                { name: "Boroa", lat: -38.9, lng: -72.8, w: 56 },
                { name: "Chonchi", lat: -42.62, lng: -73.78, w: 47 },
                { name: "Santa Bárbara", lat: -37.666, lng: -72.016, w: 46 },
            ];

            const destino = [
                {
                    name: "San Carlos de Bariloche",
                    lat: -41.133,
                    lng: -71.31,
                    w: 539,
                },
                { name: "Pichi Leufú", lat: -41.2, lng: -70.65, w: 137 },
                { name: "El Bolsón", lat: -41.967, lng: -71.533, w: 125 },
                { name: "Ñorquinco", lat: -41.966, lng: -70.883, w: 108 },
                { name: "Comallo", lat: -41.032, lng: -70.266, w: 91 },
                { name: "Las Bayas", lat: -41.35, lng: -70.7, w: 90 },
                { name: "Pilcaniyeu", lat: -41.116, lng: -70.723, w: 72 },
                { name: "Cholila", lat: -42.517, lng: -71.433, w: 66 },
                { name: "Epuyén", lat: -42.25, lng: -71.35, w: 43 },
                {
                    name: "16 de Octubre (Trevelin)",
                    lat: -43.08,
                    lng: -71.47,
                    w: 35,
                },
            ];

            function mkMap(elId, points, view) {
                const m = L.map(elId, {
                    zoomControl: false,
                    attributionControl: true,
                    dragging: false,
                    scrollWheelZoom: false,
                    doubleClickZoom: false,
                    boxZoom: false,
                    keyboard: false,
                    tap: false,
                    touchZoom: false,
                }).setView(view.center, view.zoom);

                const tiles = L.tileLayer(
                    "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                    {
                        maxZoom: 18,
                        attribution: "&copy; OpenStreetMap contrib.",
                    },
                ).addTo(m);

                // Heatmap usando pesos "crudos" y max para escalar correctamente
                const maxW = Math.max(...points.map((p) => p.w));
                L.heatLayer(
                    points.map((p) => [p.lat, p.lng, p.w]),
                    { radius: 32, blur: 22, max: maxW },
                ).addTo(m);

                // Marcadores para ver/validar los puntos
                points.forEach((p) => {
                    L.circleMarker([p.lat, p.lng], {
                        radius: 5,
                        color: "#000",
                        weight: 1,
                        fillColor: "#ff5252",
                        fillOpacity: 0.7,
                        opacity: 0.6,
                    })
                        .addTo(m)
                        .bindTooltip(`${p.name}: ${p.w}`, { direction: "top" });
                });

                // Asegurar cálculo correcto del tamaño
                setTimeout(() => m.invalidateSize(), 100);
                return m;
            }

            // ----- Utilidad para crear datasets con estilos armonizados -----
            function baseBarDataset(values) {
                return {
                    data: values,
                    borderWidth: 1,
                    // Colores suaves por defecto de Chart.js; sin establecer colores manuales
                };
            }

            function mkBar(
                ctx,
                labels,
                values,
                { horizontal = false, title = "" } = {},
            ) {
                return new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels,
                        datasets: [
                            Object.assign(baseBarDataset(values), {
                                label: title,
                            }),
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: horizontal ? "y" : "x",
                        plugins: {
                            legend: { display: false },
                            tooltip: { mode: "index", intersect: false },
                        },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: { autoSkip: true },
                            },
                            y: {
                                beginAtZero: true,
                                grid: { color: "rgba(0,0,0,0.05)" },
                            },
                        },
                    },
                });
            }

            function mkDoughnut(ctx, labels, values, { title = "" } = {}) {
                return new Chart(ctx, {
                    type: "doughnut",
                    data: {
                        labels,
                        datasets: [{ data: values }],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: "bottom" },
                            tooltip: { mode: "index", intersect: false },
                        },
                    },
                });
            }

            // ----- Render -----
            document.addEventListener("DOMContentLoaded", () => {
                // Mapas
                mkMap("mapOrigen", origen, { center: [-40.5, -72.8], zoom: 6 });
                mkMap("mapDestino", destino, {
                    center: [-41.5, -71.1],
                    zoom: 6,
                });

                mkBar(
                    document.getElementById("chartNacimientos"),
                    datosNacimientos.labels,
                    datosNacimientos.values,
                    { title: "Nacimientos" },
                );

                mkBar(
                    document.getElementById("chartMigraciones"),
                    datosMigraciones.labels,
                    datosMigraciones.values,
                    { title: "Migraciones" },
                );

                mkDoughnut(
                    document.getElementById("chartEstadoCivil"),
                    datosEstadoCivil.labels,
                    datosEstadoCivil.values,
                    { title: "Estado civil" },
                );

                mkBar(
                    document.getElementById("chartProfesiones"),
                    datosProfesiones.labels,
                    datosProfesiones.values,
                    { title: "Profesiones", horizontal: true },
                );

                mkBar(
                    document.getElementById("chartAsentamientos"),
                    datosAsentamientos.labels,
                    datosAsentamientos.values,
                    { title: "Asentamientos", horizontal: true },
                );

                mkBar(
                    document.getElementById("chartProveniencia"),
                    datosProveniencia.labels,
                    datosProveniencia.values,
                    { title: "Proveniencia", horizontal: true },
                );
            });
        </script>
    </body>
</html>
